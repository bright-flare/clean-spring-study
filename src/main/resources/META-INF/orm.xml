<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings xmlns="https://jakarta.ee/xml/ns/persistence/orm"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:schemaLocation="https://jakarta.ee/xml/ns/persistence/orm
                 https://jakarta.ee/xml/ns/persistence/orm/orm_3_0.xsd"
                 version="3.0">

  <!-- AbstractEntity MappedSuperclass -->
  <mapped-superclass class="clean.spring.study.splearn.domain.shared.AbstractEntity">
    <attributes>
      <id name="id">
        <column name="id"/>
        <generated-value strategy="IDENTITY"/>
      </id>
    </attributes>
  </mapped-superclass>
  
  <!-- Member Entity Mapping -->
  <entity class="clean.spring.study.splearn.domain.member.Member">
    <table name="member">
      <unique-constraint name="uk_member_email_address">
        <column-name>email_address</column-name>
      </unique-constraint>
      
      <unique-constraint name="uk_member_detail_id">
        <column-name>detail_id</column-name>
      </unique-constraint>
    </table>

    <!-- Inherited ID from AbstractEntity -->
    <attributes>
      <id name="id">
        <column name="id"/>
        <generated-value strategy="IDENTITY"/>
      </id>

      <!-- Basic attributes -->
      <basic name="nickname">
        <column name="nickname" nullable="false" length="100"/>
      </basic>

      <basic name="passwordHash">
        <column name="password_hash" nullable="false" length="200"/>
      </basic>

      <basic name="status">
        <column name="status" nullable="false" length="50" column-definition="varchar(50)"/>
        <enumerated>STRING</enumerated>
      </basic>

      <one-to-one name="detail" fetch="LAZY">
        <join-column name="detail_id"/>
        <cascade>
          <cascade-all/>
        </cascade>
      </one-to-one>
      
      <!-- Email (Embedded) -->
      <embedded name="email">
        <attribute-override name="email">
          <column name="email_address" nullable="false" length="150"/>
        </attribute-override>
      </embedded>
    </attributes>
  </entity>

  <!-- MemberDetail Entity Mapping -->
  <entity class="clean.spring.study.splearn.domain.member.MemberDetail">
    <table name="member_detail">
      <unique-constraint name="uk_member_detail_profile_address">
        <column-name>profile_address</column-name>
      </unique-constraint>
    </table>

    <attributes>
      <id name="id">
        <column name="id"/>
        <generated-value strategy="IDENTITY"/>
      </id>

      <basic name="introduction">
        <column column-definition="TEXT"/>
      </basic>

      <basic name="registeredAt">
        <column name="registered_at" nullable="false"/>
      </basic>

      <basic name="activatedAt">
        <column name="activated_at"/>
      </basic>

      <basic name="deactivatedAt">
        <column name="deactivated_at"/>
      </basic>
      
      <embedded name="profile"/>
    </attributes>
  </entity>

  <!-- Email Embeddable Mapping -->
  <embeddable class="clean.spring.study.splearn.domain.member.Email">
    <attributes>
      <basic name="email">
        <column name="email_address" nullable="false" length="150"/>
      </basic>
    </attributes>
  </embeddable>
  
  <embeddable class="clean.spring.study.splearn.domain.member.Profile">
    <attributes>
      <basic name="address">
        <column name="profile_address" length="20"/>
      </basic>
    </attributes>
  </embeddable>

</entity-mappings>
